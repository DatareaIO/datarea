<div class="page-content scrollable-y" fxLayout="column">
  <button md-button (click)="goBack()" flex-offset="15">
    <i class="fa fa-arrow-left" aria-hidden="true"></i>
  </button>

  <div fxLayout="column" fxLayoutAlign="start center">
    <div *ngIf="loading" fxLayout="column" fxLayoutAlign="center center">
      <md-spinner></md-spinner>
      <div class="text-hint">
        <small>Loading...</small>
      </div>
    </div>

    <div *ngIf="!loading && !dataset" fxLayout="column" fxLayoutAlign="center center">
      <div class="text-hint">
        <small>Unable to load dataset.</small>
      </div>
    </div>

    <div *ngIf="!loading && dataset" class="dataset-container">
      <h3>{{ dataset.name }}</h3>
      <div fxLayout="row">
        <span *ngIf="dataset.categories.length > 0">
          <small class="text-hint">
            {{ dataset.categories }}
          </small>
        </span>
        <span class="space-filler"></span>
        <button md-button [mdMenuTriggerFor]="versionMenu" [disabled]="dataset.versionHistory.length < 2">
          version {{ dataset.version }} &nbsp;
          <md-icon class="fa fa-caret-down" *ngIf="dataset.versionHistory.length > 1"></md-icon>
        </button>
      </div>

      <md-menu #versionMenu="mdMenu">
        <button md-menu-item
                (click)="switchToVersion(version)"
                *ngFor="let detail of dataset.versionHistory">
          version {{ detail.version }}
        </button>
      </md-menu>

      <md-tab-group>
        <md-tab label="Details">

          <md-card *ngIf="dataset.description">
            <md-card-header>
              <md-card-title>Description</md-card-title>
            </md-card-header>
            <md-card-content>
              <p [innerHTML]="dataset.description"></p>
            </md-card-content>
          </md-card>

          <md-card *ngIf="dataset.tags.length > 0">
            <md-card-header>
              <md-card-title>Tags</md-card-title>
            </md-card-header>
            <md-card-content>
              <md-chip-list>
                <md-chip color="primary" *ngFor="let tag of dataset.tags">{{ tag }}</md-chip>
              </md-chip-list>
            </md-card-content>
          </md-card>

          <md-card>
            <md-card-header>
              <md-card-title>Publication</md-card-title>
            </md-card-header>
            <md-card-content>
              <md-list>
                <md-list-item *ngIf="dataset.publisher">
                  <md-icon md-list-icon class="fa fa-user" aria-hidden="true"></md-icon>
                  <p md-line>Publisher</p>
                  <p md-line>{{ dataset.publisher }}</p>
                </md-list-item>
                <md-list-item>
                  <md-icon md-list-icon class="fa fa-link" aria-hidden="true"></md-icon>
                  <p md-line>Dataset Link</p>
                  <p md-line>
                    <a target="_blank" href="{{ dataset.portalLink }}">{{ dataset.portal }}</a>
                  </p>
                </md-list-item>
                <md-list-item *ngIf="dataset.license">
                  <md-icon md-list-icon class="fa fa-bookmark" aria-hidden="true"></md-icon>
                  <p md-line>License</p>
                  <p md-line>{{ dataset.license }}</p>
                </md-list-item>
                <md-list-item>
                  <md-icon md-list-icon class="fa fa-calendar" aria-hidden="true"></md-icon>
                  <p md-line>Created</p>
                  <p md-line>{{ dataset.createdTime | date: 'short' }}</p>
                </md-list-item>
                <md-list-item>
                  <md-icon md-list-icon class="fa fa-calendar" aria-hidden="true"></md-icon>
                  <p md-line>Updated</p>
                  <p md-line>{{ dataset.updatedTime | date: 'short' }}</p>
                </md-list-item>
              </md-list>
            </md-card-content>
          </md-card>

        </md-tab>

        <md-tab label="Data & Files" *ngIf="dataset.data.length > 0">
          <md-card *ngFor="let data of dataset.data">
            <md-card-header>
              <md-card-title>{{ data.name }}</md-card-title>
              <md-card-subtitle *ngIf="data.format && data.format !== data.name">{{ data.format }}</md-card-subtitle>
            </md-card-header>
            <md-card-content *ngIf="data.description">
              <p [innerHTML]="data.description"></p>
            </md-card-content>
            <md-card-actions>
              <button type="button" md-button (click)="openData(data.link)">
                <i class="fa fa-download" aria-hidden="true"></i> &nbsp; Open
              </button>
              <button type="button" md-button ngxClipboard
                      [cbContent]="data.link"
                      (click)="openSnackBar('Data link copied to the clipboard!')">
                <i class="fa fa-clipboard" aria-hidden="true"></i> &nbsp; Copy Link
              </button>
            </md-card-actions>
          </md-card>
        </md-tab>

      <md-tab label="History">
        <md-card>
          <md-card-header>
            <md-card-title>Versions</md-card-title>
          </md-card-header>
          <md-card-content>
            <md-list>
              <md-list-item *ngFor="let detail of dataset.versionHistory">
                <p md-line><strong>Version {{ detail.version }}</strong></p>
                <p md-line>Updated at {{ detail.updatedTime | date: 'short' }}</p>
              </md-list-item>
            </md-list>
          </md-card-content>
        </md-card>
      </md-tab>

      </md-tab-group>
    </div>
  </div>

</div>
